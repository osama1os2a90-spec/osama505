<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>بنك الأسئلة الكيميائية — اختبار تفاعلي</title>
<style>
  :root{
    --panel-bg:#ffffffee;
    --ink:#0e2430;
    --accent:#0aa;
    --accent2:#0a6;
    --muted:#6b7b8c;
    --cool1:#eef7ff;
    --cool2:#e7fbff;
    --coolBorder:#cfe7ff;
    --coolText:#0b6b88;
    --danger:#e74c3c;
  }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Tahoma,Arial,sans-serif;background:#eaf6ff;color:var(--ink);overflow-x:hidden}

  /* ===== خلفية فل سكرين: ذرات وإلكترونات ===== */
  .bg{position:fixed; inset:0; z-index:-2; overflow:hidden;
    background: radial-gradient(60% 40% at 50% -10%, #dff6ff 0%, #effbff 45%, #f7fffb 100%);
  }
  .atom{position:absolute; opacity:.85}
  .atom svg{filter:drop-shadow(0 4px 14px rgba(0,0,0,.10))}
  .e{-webkit-animation: spin linear infinite; animation: spin linear infinite; transform-origin:center}
  @keyframes spin{from{transform:rotate(0)} to{transform:rotate(360deg)}}

  /* ===== واجهة ===== */
  .wrap{max-width:1100px;margin:22px auto;padding:12px}
  .card{
    max-width:1000px;margin:28px auto;padding:22px 20px 28px;border-radius:16px;background:var(--panel-bg);
    box-shadow:0 12px 34px rgba(0,0,0,.10); backdrop-filter:saturate(1.05) blur(6px)
  }
  h1,h2,h3{margin:0 0 12px}
  .muted{color:var(--muted)}
  .row{display:flex;flex-wrap:wrap;gap:12px}
  .col{flex:1 1 280px}
  input[type="text"], select, textarea{
    width:100%;padding:12px 14px;border:1px solid #e2edf2;border-radius:12px;font-size:16px;outline:none;background:#fff
  }
  textarea{min-height:110px; resize:vertical}
  button{border:0;border-radius:12px;padding:12px 16px;font-size:16px;cursor:pointer}
  .btn-primary{background:var(--accent);color:#fff}
  .btn-secondary{background:#e9f7f8;color:#066}
  .btn-ghost{background:transparent;border:1px solid #cfe7ea;color:#055}
  .btn-danger{background:var(--danger);color:#fff}
  .progress{height:10px;background:#e9f2f6;border-radius:99px;overflow:hidden}
  .bar{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .3s}
  .q-num{display:inline-block;min-width:40px;height:40px;border-radius:999px;background:#ecfeff;color:#066;line-height:40px;text-align:center;font-weight:700}
  .choices{display:grid;gap:10px;margin-top:10px}
  .choice{padding:12px;border:1px solid #dceaf0;border-radius:12px;background:#fff;cursor:pointer}
  .choice:hover{border-color:#b6dce1}
  .choice.selected{outline:2px solid #9ce4eb}
  .center{text-align:center}
  .timer{font-variant-numeric:tabular-nums;font-weight:700}
  .pill{display:inline-block;padding:.25rem .65rem;border-radius:999px;background:#eef7ff;border:1px solid #cfe5ff;color:#055;font-size:12px}
  .footer{margin-top:16px;display:flex;gap:8px;justify-content:space-between;align-items:center;flex-wrap:wrap}
  .toast{position:fixed;inset-inline:0;top:12px;display:flex;justify-content:center;z-index:999}
  .toast > div{max-width:900px;background:#fff;border:1px solid #e7eef3;padding:12px 14px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.08)}
  .hidden{display:none !important}
  .no-select{user-select:none;-webkit-user-select:none;-ms-user-select:none}
  .tag{display:inline-block;background:#fff8e6;border:1px solid #ffe2a8;color:#7a4b00;padding:.15rem .5rem;border-radius:999px;font-size:12px;margin-inline-start:6px}

  /* ===== نافذة الألغاز (كل سؤال خامس) ===== */
  .riddle-backdrop{position:fixed; inset:0; background:rgba(0,30,40,.35); display:flex; align-items:center; justify-content:center; z-index:50}
  .riddle{max-width:640px; background:#ffffff; border:1px solid #d6ecf5; border-radius:16px; padding:18px 18px 16px; box-shadow:0 18px 40px rgba(0,0,0,.18)}
  .riddle h3{margin:0 0 8px}
  .riddle .grid{display:grid; grid-template-columns:1fr; gap:10px}
  .riddle .note{font-size:13px; color:#255}
  .ok{color:#1e7f56; font-weight:700; margin-inline-start:8px}
  .bad{color:#b2342e; font-weight:700; margin-inline-start:8px}

  /* ===== قسم المدرّسين — لون بارد ===== */
  .cool-links{ margin-top:14px; padding:14px; border-radius:14px;
    background:linear-gradient(180deg,var(--cool1),var(--cool2)); border:1px solid var(--coolBorder); }
  .cool-links h3{ margin:0 0 10px; color:#0a5973 }
  .cool-links ul{ margin:0; padding:0; list-style:none }
  .cool-links li{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px 12px; border-radius:12px; background:#ffffffcc; border:1px solid #e4f3ff; margin-top:8px }
  .cool-links .name{ color:#084e63; font-weight:700 }
  .cool-links a{ color:var(--coolText); text-decoration:none; font-weight:700 }
  .cool-links a:hover{ text-decoration:underline }
</style>
</head>
<body>
  <!-- ===== خلفية: ذرات وإلكترونات تدور ===== -->
  <div class="bg" aria-hidden="true" id="bg">
    <!-- ذرة 1 -->
    <div class="atom" style="left:6%; top:58%;">
      <svg width="180" height="180" viewBox="0 0 180 180">
        <defs>
          <radialGradient id="nucl1" cx="50%" cy="50%">
            <stop offset="0" stop-color="#9ae7ff"/><stop offset="1" stop-color="#dff8ff"/>
          </radialGradient>
        </defs>
        <!-- نواة -->
        <circle cx="90" cy="90" r="14" fill="url(#nucl1)" stroke="#7fd3ea"/>
        <!-- مدارات -->
        <ellipse cx="90" cy="90" rx="70" ry="24" fill="none" stroke="#a7e6ee"/>
        <ellipse cx="90" cy="90" rx="24" ry="70" fill="none" stroke="#a7e6ee"/>
        <g class="e" style="animation-duration:22s">
          <circle cx="160" cy="90" r="6" fill="#4fd3c6"/>
        </g>
        <g class="e" style="animation-duration:18s">
          <circle cx="90" cy="20" r="6" fill="#00b9d1"/>
        </g>
      </svg>
    </div>
    <!-- ذرة 2 -->
    <div class="atom" style="left:72%; top:12%;">
      <svg width="220" height="220" viewBox="0 0 200 200">
        <circle cx="100" cy="100" r="16" fill="#d9fff4" stroke="#7edfc4"/>
        <ellipse cx="100" cy="100" rx="78" ry="28" fill="none" stroke="#b7f1e0"/>
        <ellipse cx="100" cy="100" rx="28" ry="78" fill="none" stroke="#b7f1e0"/>
        <g class="e" style="animation-duration:26s"><circle cx="178" cy="100" r="6" fill="#55d39e"/></g>
        <g class="e" style="animation-duration:20s"><circle cx="100" cy="22" r="6" fill="#18c18d"/></g>
      </svg>
    </div>
    <!-- ذرة 3 -->
    <div class="atom" style="left:38%; top:78%; opacity:.75">
      <svg width="160" height="160" viewBox="0 0 160 160">
        <circle cx="80" cy="80" r="12" fill="#f0fff8" stroke="#a4f0c8"/>
        <ellipse cx="80" cy="80" rx="60" ry="22" fill="none" stroke="#ccf7e8"/>
        <ellipse cx="80" cy="80" rx="22" ry="60" fill="none" stroke="#ccf7e8"/>
        <g class="e" style="animation-duration:24s"><circle cx="140" cy="80" r="5" fill="#2bd07a"/></g>
        <g class="e" style="animation-duration:17s"><circle cx="80" cy="20" r="5" fill="#2ad3a3"/></g>
      </svg>
    </div>
  </div>

  <div class="wrap">
    <!-- ===== الصفحة الرئيسية ===== -->
    <section id="start" class="card">
      <h1>بنك الأسئلة الكيميائية</h1>
      <p class="muted">
        منصة تدريبية لقياس فهمك وتعزيز مراجعتك في كيمياء 1 (نظام المسارات).
        تغطي الأسئلة: طبقة الأوزون وثقب الأوزون، اتفاقية/بروتوكول مونتريال، مركبات CFC وتأثيرها،
        العوامل الجوية، والأشعة فوق البنفسجية وآثارها.
      </p>
      <ul class="muted" style="margin:0 0 10px 18px">
        <li>الهدف: قياس الفهم وتحديد نقاط التحسين.</li>
        <li>مدة الاختبار: <strong>55 دقيقة</strong>. عدد الأسئلة: <strong>50</strong>.</li>
        <li>سؤال واحد في كل مرة • مسموح الرجوع للسابق • لا سكب للأمام • لا تُعرض صح/خطأ أثناء الحل.</li>
      </ul>
      <div class="row">
        <div class="col">
          <label>اسم الطالب</label>
          <input id="studentName" type="text" placeholder="اكتب الاسم الثلاثي" autocomplete="off">
        </div>
        <div class="col">
          <label>الشعبة</label>
          <select id="section">
            <option value="">اختر الشعبة</option>
            <option>1</option><option>2</option><option>3</option><option>4</option>
            <option>5</option><option>6</option><option>7</option>
          </select>
        </div>
      </div>
      <div class="footer">
        <div class="muted">الخلفية ذرات وإلكترونات متحركة • يمنع النسخ والطباعة أثناء الاختبار</div>
        <button id="startBtn" class="btn-primary" type="button">ابدأ الاختبار</button>
      </div>
    </section>

    <!-- ===== شاشة السؤال ===== -->
    <section id="quiz" class="card hidden">
      <div class="row" style="align-items:center; gap:16px">
        <div class="q-num" id="qNum">1</div>
        <div style="flex:1">
          <div class="progress"><div id="bar" class="bar"></div></div>
          <small class="muted"><span id="progressText">سؤال 1 من 50</span> • <span class="timer" id="timer">55:00</span></small>
        </div>
        <div><span id="topicTag" class="tag">موضوع</span></div>
      </div>

      <div id="qText" class="no-select" style="margin-top:12px;font-size:20px;line-height:1.7"></div>
      <div id="choices" class="choices"></div>

      <div class="footer">
        <div class="muted"></div>
        <div style="display:flex; gap:8px">
          <button id="prevBtn" class="btn-ghost" type="button">السابق</button>
          <button id="confirmBtn" class="btn-primary" type="button" disabled>تأكيد الإجابة</button>
          <button id="nextBtn" class="btn-secondary" type="button" disabled>التالي</button>
        </div>
      </div>
    </section>

    <!-- ===== شاشة النتيجة ===== -->
    <section id="result" class="card hidden">
      <h2>النتيجة</h2>
      <p id="scoreLine" style="font-size:18px"></p>
      <details open>
        <summary>تقرير الأسئلة والإجابات</summary>
        <div id="report" style="margin-top:10px"></div>
      </details>

      <!-- ملاحظات الطالب على الاختبار -->
      <div style="margin-top:16px">
        <h3>ملاحظاتك على الاختبار</h3>
        <textarea id="notes" placeholder="اكتب ملاحظاتك على الاختبار (ما كان سهل؟ ما يحتاج مراجعة؟)"></textarea>
      </div>

      <!-- أسئلة انعكاسية مرتبطة بالهدف -->
      <div style="margin-top:12px">
        <h3>أسئلة مرتبطة بالهدف</h3>
        <p class="muted">س1) اختر فكرة واحدة من المنهج (مثلاً: الأوزون/مونتريال) واشرح كيف تؤثر على حياتنا اليومية؟</p>
        <p class="muted">س2) ما الاستراتيجية التي ستستخدمها لتحسين إجاباتك في الأسئلة التي أخطأت فيها؟</p>
      </div>

      <hr/>
      <div style="margin:8px 0 16px">
        <strong>فريق الطلحة</strong><br/>
        أسامه ال سليمان • راكان الحربي • عبد الإله الشمري • أسامه العدواني • متعب الوسمي • عبدالمحسن العتيبي • عبدالوهاب الشهري
      </div>

      <!-- مدرّسون يوتيوب — اسم المدرس + الرابط -->
      <div class="cool-links">
        <h3>مدرّسون على يوتيوب لشرح كيمياء 1 (أول ثانوي)</h3>
        <ul>
          <li><span class="name">قناة عين دروس (وزارة التعليم)</span><a href="https://www.youtube.com/@iEN_TV" target="_blank" rel="noopener">رابط اليوتيوب</a></li>
          <li><span class="name">محمد زيادة — Ziada for Science</span><a href="https://www.youtube.com/@ziadaforscience" target="_blank" rel="noopener">رابط اليوتيوب</a></li>
          <li><span class="name">أ. هدى الغوينم</span><a href="https://www.youtube.com/@HudaAlGhuwaim" target="_blank" rel="noopener">رابط اليوتيوب</a></li>
          <li><span class="name">أحمد الحربي (كيمياء)</span><a href="https://www.youtube.com/@AhmadAlharbiEdu" target="_blank" rel="noopener">رابط اليوتيوب</a></li>
          <li><span class="name">وليد أبو الخير التعليمية</span><a href="https://www.youtube.com/@waleedabualkhair" target="_blank" rel="noopener">رابط اليوتيوب</a></li>
        </ul>
      </div>

      <div class="footer">
        <button class="btn-ghost" onclick="location.reload()">إعادة المحاولة</button>
      </div>
    </section>
  </div>

  <!-- نافذة الألغاز -->
  <div id="riddleModal" class="riddle-backdrop hidden" role="dialog" aria-modal="true" aria-labelledby="rTitle">
    <div class="riddle">
      <h3 id="rTitle">لغز مساعدة (3 خانات) — أكمل الإجابة المركّبة</h3>
      <p class="note">هذا اللغز يظهر كل خمسة أسئلة (5، 10، 15، …). يجب حل اللغز لتتمكّن من المتابعة.</p>
      <div class="grid">
        <input id="r1" type="text" placeholder="لغز 1">
        <input id="r2" type="text" placeholder="لغز 2">
        <input id="r3" type="text" placeholder="لغز 3">
      </div>
      <div class="footer">
        <div class="muted" id="rMsg"></div>
        <div style="display:flex;gap:8px">
          <button id="rClose" class="btn-ghost" type="button">إلغاء</button>
          <button id="rCheck" class="btn-primary" type="button">تحقق من اللغز</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast hidden" role="status" aria-live="polite"><div id="toastMsg"></div></div>

<script>
/* =================== إعدادات عامة =================== */
// وقت الاختبار: 55 دقيقة
let remainingSec = 55*60;
// لا تُعرض صح/خطأ أثناء الحل — الصوت فقط عند الضغط على أي إجابة
const SHOW_FEEDBACK_DURING_TEST = false;

// تشغيل صوت نغمة قصيرة عند الضغط على إجابة
let audioCtx;
function clickTone(){
  if(!audioCtx){ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }
  const osc = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  osc.connect(g); g.connect(audioCtx.destination);
  osc.type='sine'; osc.frequency.value=520;
  g.gain.value=0.06;
  osc.start(); setTimeout(()=>{osc.stop()},120);
}

/* =================== بنك الأسئلة (50 سؤالًا — مختصر نفس مواضيعك) =================== */
const QUESTIONS = [
  {"q":"ما الهدف ا\u200fلساسي من اجتماع الزعماء في مونتريال؟","choices":["حماية طبقة الأوزون","توقيع معاهدات تجارية","زيادة إنتاج الطاقة"],"answer":0,"topic":"اتفاقية/بروتوكول مونتريال"},
  {"q":"عُقد اجتماع مونتريال عام 1987 من أجل","choices":["وضع بروتوكول لحماية الأوزون","تقليل انبعاثات CO2","تطوير الطاقة الشمسية"],"answer":0,"topic":"اتفاقية/بروتوكول مونتريال"},
  {"q":"اتفاقية مونتريال اهتمت خصوصًا بـ","choices":["حماية طبقة الأوزون من الملوثات","حماية البحار","حماية الغابات"],"answer":0,"topic":"اتفاقية/بروتوكول مونتريال"},
  {"q":"من نتائج اجتماع مونتريال","choices":["حظر استخدام CFCs تدريجيًا","منع استخدام السيارات","فرض ضرائب على الوقود"],"answer":0,"topic":"اتفاقية/بروتوكول مونتريال"},
  {"q":"العامل الرئيس في تكوّن ثقب الأوزون فوق القطب الجنوبي","choices":["مركبات الكلوروفلوروكربون","بخار الماء","غاز الأكسجين"],"answer":0,"topic":"طبقة الأوزون وثقب الأوزون"},
  {"q":"مادة كيميائية تساهم في تدمير الأوزون","choices":["الكلوروفلوروكربون","ثاني أكسيد الكربون","النيتروجين"],"answer":0,"topic":"مركبات CFC وتأثيرها"},
  {"q":"لماذا يظهر الثقب بوضوح فوق القارة القطبية الجنوبية؟","choices":["الظروف الباردة تُنشّط التفاعلات","قربها من خط الاستواء","لأنها أكثر المناطق حرارة"],"answer":0,"topic":"العوامل الجوية"},
  {"q":"من العوامل التي تساعد على اتساع الثقب","choices":["شدة الرياح القطبية","نشاط البراكين","زيادة الغازات الدفيئة"],"answer":0,"topic":"العوامل الجوية"},
  {"q":"يتكوّن معظم الأوزون عند خط الاستواء بسبب","choices":["قوة UV","كثرة الأمطار","وجود غابات مطيرة"],"answer":0,"topic":"طبقة الأوزون وثقب الأوزون"},
  {"q":"تكوّن الأوزون يعتمد على","choices":["الضوء فوق البنفسجي","الضوء المرئي","الأشعة تحت الحمراء"],"answer":0,"topic":"طبقة الأوزون وثقب الأوزون"},
  {"q":"أين يكون تركيز الأوزون أعلى عادةً؟","choices":["في الستراتوسفير","على سطح الأرض","عند خط الاستواء"],"answer":0,"topic":"طبقة الأوزون وثقب الأوزون"},
  {"q":"غاز يتفاعل مع الأوزون مسببًا تفككه","choices":["الكلور","الهيليوم","النيون"],"answer":0,"topic":"مركبات CFC وتأثيرها"},
  {"q":"أثر ثقب الأوزون على UV الواصلة للسطح","choices":["يزيد من وصولها","لا يؤثر","يقلل وصولها"],"answer":0,"topic":"الأشعة فوق البنفسجية وآثارها"},
  {"q":"عند إطلاق CFCs يحدث للأوزون","choices":["يتآكل ويتناقص","يزداد سمكًا","يتحول إلى أكسجين"],"answer":0,"topic":"مركبات CFC وتأثيرها"},
  {"q":"بدائل أكثر أمانًا من CFCs","choices":["HCFCs/HFCs ثم التخلص التدريجي","الهيليوم","الميثان"],"answer":0,"topic":"مركبات CFC وتأثيرها"},
  {"q":"الأوزون يتكوّن أساسًا في","choices":["الستراتوسفير","التروبوسفير","الميزوسفير"],"answer":0,"topic":"طبقة الأوزون وثقب الأوزون"},
  {"q":"زيادة UV قد تؤدي إلى","choices":["سرطان الجلد","تحسين النظر","تسريع نمو الشعر"],"answer":0,"topic":"الأشعة فوق البنفسجية وآثارها"},
  {"q":"مصادر CFCs الشائعة سابقًا","choices":["مكيفات/تبريد/رذاذات","مصابيح LED","أسلاك النحاس"],"answer":0,"topic":"مركبات CFC وتأثيرها"},
  {"q":"المناطق القطبية أكثر حساسية لتآكل الأوزون بسبب","choices":["الدوامات القطبية والبرودة","الغابات الكثيفة","الحرارة العالية"],"answer":0,"topic":"العوامل الجوية"},
  {"q":"ينتج الأوزون طبيعيًا من","choices":["تفكك O2 بفعل UV ثم اتحاد O مع O2","تبخر الماء","احتراق الوقود"],"answer":0,"topic":"طبقة الأوزون وثقب الأوزون"},
  {"q":"التعرّض الزائد لـ UV قد يسبب","choices":["حروق جلدية","زيادة النشاط","تحسن دائم للمزاج"],"answer":0,"topic":"الأشعة فوق البنفسجية وآثارها"},
  {"q":"وجود ثقب الأوزون يعني","choices":["انخفاضًا كبيرًا في تركيز O3 بمنطقة معينة","ارتفاع O3 عالميًا","عدم وجود O3 نهائيًا"],"answer":0,"topic":"طبقة الأوزون وثقب الأوزون"},
  {"q":"العلاقة بين CFC والكلور","choices":["CFC يحرر كلورًا نشطًا يفكك O3","CFC يحول الكلور لملح الطعام","لا علاقة"],"answer":0,"topic":"مركبات CFC وتأثيرها"},
  {"q":"تفعيل تفاعلات التحلل في القطب يرتبط بـ","choices":["غيوم الستراتوسفير القطبية الباردة","الغيوم الركامية","ضباب التروبوسفير"],"answer":0,"topic":"العوامل الجوية"},
  {"q":"أثر صحي محتمل لزيادة UV","choices":["إعتام عدسة العين","تقوية العظام مباشرة","تحسن السمع"],"answer":0,"topic":"الأشعة فوق البنفسجية وآثارها"},
  {"q":"يساعد بروتوكول مونتريال على","choices":["خفض إنتاج/استخدام CFCs عالميًا","زيادة زراعة الأشجار فقط","تقليل استهلاك الماء"],"answer":0,"topic":"اتفاقية/بروتوكول مونتريال"},
  {"q":"دافع رئيس للاتفاقية","choices":["حماية طبقة الأوزون","خفض أسعار النفط","فتح أسواق جديدة"],"answer":0,"topic":"اتفاقية/بروتوكول مونتريال"},
  {"q":"تأثير ثقب الأوزون على العوالق النباتية","choices":["تضررها من UV الزائد","زيادة إنتاجيتها دومًا","لا تأثير"],"answer":0,"topic":"الأشعة فوق البنفسجية وآثارها"},
  {"q":"أزيلت CFCs من الرذاذات لأنها","choices":["تتلف الأوزون","باهظة الثمن","سامة باللمس"],"answer":0,"topic":"مركبات CFC وتأثيرها"},
  {"q":"يوجد معظم الأوزون في","choices":["الستراتوسفير","التروبوسفير","الثرموسفير"],"answer":0,"topic":"طبقة الأوزون وثقب الأوزون"},
  {"q":"وضوح الثقب فوق القطب الجنوبي بسبب","choices":["الدوامة القطبية والبرودة","التيارات الدافئة","شدة الأمطار"],"answer":0,"topic":"العوامل الجوية"},
  {"q":"جرعات UV أعلى من الطبيعي تسبب","choices":["حروق وسرطان جلد","تقوية فورية للعضلات","تهدئة عصبية دائمة"],"answer":0,"topic":"الأشعة فوق البنفسجية وآثارها"},
  {"q":"بدائل CFC لاحقًا","choices":["HCFCs/HFCs ثم التخلص التدريجي","الغازات النبيلة","النيتروجين"],"answer":0,"topic":"مركبات CFC وتأثيرها"},
  {"q":"الأوزون جزيء مكوّن من","choices":["ثلاث ذرات أكسجين","ذرتي أكسجين","O وN"],"answer":0,"topic":"طبقة الأوزون وثقب الأوزون"},
  {"q":"زيادة UV على النبات تؤدي إلى","choices":["تلف أنسجة وتقليل نمو","زيادة الإزهار دائمًا","لا تأثير"],"answer":0,"topic":"الأشعة فوق البنفسجية وآثارها"},
  {"q":"مصطلح «ثقب» لا يعني","choices":["غياب الأوزون تمامًا","انخفاضًا كبيرًا محليًا","منطقة محددة موسميًا"],"answer":0,"topic":"طبقة الأوزون وثقب الأوزون"},
  {"q":"تحت UV، CFCs","choices":["تتحلل وتطلق كلورًا نشطًا","تتحول إلى ماء","تكوّن أوزون"],"answer":0,"topic":"مركبات CFC وتأثيرها"},
  {"q":"تزداد UV عند السطح عندما","choices":["يتآكل الأوزون","ترتفع السحب المنخفضة","يزداد CO2 فقط"],"answer":0,"topic":"الأشعة فوق البنفسجية وآثارها"},
  {"q":"التعرّض المزمن لـ UV على العين قد يسبب","choices":["إعتام عدسة","تحسن الرؤية الليلية","لا شيء"],"answer":0,"topic":"الأشعة فوق البنفسجية وآثارها"},
  {"q":"وظيفة الأوزون في الستراتوسفير","choices":["امتصاص جزء كبير من UV","توليد الأكسجين للتنفس","تسخين الأرض"],"answer":0,"topic":"طبقة الأوزون وثقب الأوزون"},
  {"q":"ذرة كلور واحدة يمكنها","choices":["تفكيك عدد كبير من جزيئات O3","تفكيك جزيء واحد فقط","لا تؤثر"],"answer":0,"topic":"مركبات CFC وتأثيرها"},
  {"q":"الوقاية من UV تشمل","choices":["واقي شمس/نظارات/تقليل التعرض","الجلوس تحت مصباح UV","عدم ارتداء القبعات"],"answer":0,"topic":"الأشعة فوق البنفسجية وآثارها"},
  {"q":"تأثير بروتوكول مونتريال عالميًا","choices":["انخفاض تدريجي لمستويات المركبات المدمرة للأوزون","ارتفاع فوري لدرجات الحرارة","انعدام السحب القطبية"],"answer":0,"topic":"اتفاقية/بروتوكول مونتريال"},
  {"q":"ظهور الثقب يكون","choices":["موسميًا ويبلغ الذروة في الربيع القطبي","ثابتًا طوال العام","في الصيف فقط"],"answer":0,"topic":"العوامل الجوية"},
  {"q":"جرعات UVB الزائدة قد تؤدي إلى","choices":["سرطان الجلد/أضرار DNA","تقوية العظام مباشرة","زيادة الذكاء"],"answer":0,"topic":"الأشعة فوق البنفسجية وآثارها"},
  {"q":"HCFCs هي","choices":["بدائل انتقالية أقل ضررًا","غازات خاملة تمامًا","نفس CFCs"],"answer":0,"topic":"مركبات CFC وتأثيرها"},
  {"q":"تحلّل CFCs يحدث غالبًا في","choices":["الستراتوسفير تحت UV","التروبوسفير ليلًا","سطح الأرض"],"answer":0,"topic":"مركبات CFC وتأثيرها"},
  {"q":"زيادة ثقوب الأوزون تعني","choices":["مناطق أكبر بانخفاض O3","اختفاء الأوزون كليًا","لا اختلاف"],"answer":0,"topic":"طبقة الأوزون وثقب الأوزون"},
  {"q":"إرشاد مهم في هذا الاختبار","choices":["لا تُعرض الصح/الخطأ حتى النهاية","تُعرض الصح فورًا","يسمح بالسكب"],"answer":0,"topic":"تعليمات الاختبار"},
  {"q":"زمن الاختبار هو","choices":["55 دقيقة","60 دقيقة","45 دقيقة"],"answer":0,"topic":"تعليمات الاختبار"}
];

/* ===== خريطة أسباب الخطأ + اسم الدرس + رابط (مع دقيقة تقريبية) ===== */
const TOPIC_REVIEW = {
  "اتفاقية/بروتوكول مونتريال": { reason:"لم تميّز بين حماية الأوزون وتقليل CO2.", lesson:"بروتوكول مونتريال وحماية طبقة الأوزون", url:"https://www.youtube.com/results?search_query=%D8%A8%D8%B1%D9%88%D8%AA%D9%88%D9%83%D9%88%D9%84+%D9%85%D9%88%D9%86%D8%AA%D8%B1%D9%8A%D8%A7%D9%84+%D8%A7%D9%84%D8%A3%D9%88%D8%B2%D9%88%D9%86", t:60 },
  "طبقة الأوزون وثقب الأوزون": { reason:"خلطت بين تركيب الأوزون ومكان تكوّنه.", lesson:"طبقة الأوزون وثقب الأوزون — كيمياء 1", url:"https://www.youtube.com/results?search_query=%D8%B7%D8%A8%D9%82%D8%A9+%D8%A7%D9%84%D8%A3%D9%88%D8%B2%D9%88%D9%86+%D8%AB%D9%82%D8%A8+%D8%A7%D9%84%D8%A3%D9%88%D8%B2%D9%88%D9%86+%D9%83%D9%8A%D9%85%D9%8A%D8%A7%D8%A1+1", t:75 },
  "مركبات CFC وتأثيرها": { reason:"لم تربط بين تحلّل CFCs وإطلاق الكلور النشط.", lesson:"مركبات CFC وتأثيرها على الأوزون", url:"https://www.youtube.com/results?search_query=CFCs+%D9%88%D8%AA%D8%AF%D9%85%D9%8A%D8%B1+%D8%A7%D9%84%D8%A3%D9%88%D8%B2%D9%88%D9%86+%D9%83%D9%8A%D9%85%D9%8A%D8%A7%D8%A1+1", t:90 },
  "العوامل الجوية": { reason:"فاتك دور السحب القطبية والدوامة الباردة.", lesson:"العوامل الجوية وثقب الأوزون (الدوامة القطبية)", url:"https://www.youtube.com/results?search_query=%D8%A7%D9%84%D8%AF%D9%88%D8%A7%D9%85%D8%A9+%D8%A7%D9%84%D9%82%D8%B7%D8%A8%D9%8A%D8%A9+%D9%88%D8%AB%D9%82%D8%A8+%D8%A7%D9%84%D8%A3%D9%88%D8%B2%D9%88%D9%86", t:50 },
  "الأشعة فوق البنفسجية وآثارها": { reason:"لم تربط زيادة UV بالآثار الصحية والبيئية.", lesson:"الأشعة فوق البنفسجية وآثارها الصحية والبيئية", url:"https://www.youtube.com/results?search_query=%D8%A7%D9%84%D8%A3%D8%B4%D8%B9%D8%A9+%D9%81%D9%88%D9%82+%D8%A7%D9%84%D8%A8%D9%86%D9%81%D8%B3%D8%AC%D9%8A%D8%A9+%D9%83%D9%8A%D9%85%D9%8A%D8%A7%D8%A1+1", t:70 },
  "تعليمات الاختبار": { reason:"هذه أسئلة إرشادية حول قواعد الاختبار.", lesson:"مهارات الاختبار والتعامل مع الأسئلة", url:"https://www.youtube.com/results?search_query=%D9%85%D9%87%D8%A7%D8%B1%D8%A7%D8%AA+%D8%AD%D9%84+%D8%A7%D9%84%D8%A7%D8%AE%D8%AA%D8%A8%D8%A7%D8%B1%D8%A7%D8%AA", t:40 }
};

/* ===== ألغاز مساعدة (تظهر عند الأسئلة: 5، 10، 15، ...، 50) =====
  — كل لغز من 3 خانات تكوّن كلمة/رمز بسيط. */
const RIDDLE_INDEXES = new Set([5,10,15,20,25,30,35,40,45,50]); // أرقام الأسئلة (1-based)
const RIDDLES = {
  5:  { prompt:"أكمل رمز الأوزون (3 خانات):", a:["O","3",""], ok:["O","3",""] },
 10: { prompt:"أكمل كلمة (مونتريال):", a:["مو","نت","ريال"], ok:["مو","نت","ريال"] },
 15: { prompt:"أكمل (C F C):", a:["C","F","C"], ok:["C","F","C"] },
 20: { prompt:"أكمل (U V — أشعة):", a:["U","V",""], ok:["U","V",""] },
 25: { prompt:"أكمل (كلـ — ـور):", a:["كل","ـ","ور"], ok:["كل","ـ","ور"] },
 30: { prompt:"أكمل (O2 + O → O3):", a:["O2","+O","O3"], ok:["O2","+O","O3"] },
 35: { prompt:"أكمل (HC — FC — s):", a:["HC","FC","s"], ok:["HC","FC","s"] },
 40: { prompt:"أكتب (ثـ — قـ — ب):", a:["ثـ","قـ","ب"], ok:["ثـ","قـ","ب"] },
 45: { prompt:"أكمل (سترا — توس — فير):", a:["سترا","توس","فير"], ok:["سترا","توس","فير"] },
 50: { prompt:"أكتب (كيمياء 1):", a:["كي","مياء","1"], ok:["كي","مياء","1"] }
};
let solvedRiddles = {}; // {index:true}

/* ===== حالة الاختبار ===== */
let current = 0;
let selectedIndex = null;
let confirmed = new Array(QUESTIONS.length).fill(false);
let answers = new Array(QUESTIONS.length).fill(null);
let timerId = null;

/* ===== DOM ===== */
const elStart = document.getElementById('start');
const elQuiz = document.getElementById('quiz');
const elResult = document.getElementById('result');
const elQText = document.getElementById('qText');
const elChoices = document.getElementById('choices');
const elQNum = document.getElementById('qNum');
const elBar = document.getElementById('bar');
const elProg = document.getElementById('progressText');
const elTimer = document.getElementById('timer');
const elTopic = document.getElementById('topicTag');
const btnStart = document.getElementById('startBtn');
const btnConfirm = document.getElementById('confirmBtn');
const btnNext = document.getElementById('nextBtn');
const btnPrev = document.getElementById('prevBtn');

const elToast = document.getElementById('toast');
const elToastMsg = document.getElementById('toastMsg');

const modal = document.getElementById('riddleModal');
const r1 = document.getElementById('r1');
const r2 = document.getElementById('r2');
const r3 = document.getElementById('r3');
const rMsg = document.getElementById('rMsg');
const rCheck = document.getElementById('rCheck');
const rClose = document.getElementById('rClose');
const rTitle = document.getElementById('rTitle');

/* ===== Toast ===== */
function showToast(msg, ms=1600){
  elToastMsg.textContent = msg;
  elToast.classList.remove('hidden');
  setTimeout(()=> elToast.classList.add('hidden'), ms);
}

/* ===== منع النسخ/اللصق والطباعة أثناء الاختبار ===== */
document.addEventListener('copy', e=>{ if(!elQuiz.classList.contains('hidden')) e.preventDefault(); });
document.addEventListener('contextmenu', e=>{ if(!elQuiz.classList.contains('hidden')) e.preventDefault(); });
document.addEventListener('keydown', e=>{
  if(!elQuiz.classList.contains('hidden')){
    const k = e.key.toLowerCase();
    if((e.ctrlKey||e.metaKey) && ['c','x','a','s','p'].includes(k)) e.preventDefault();
  }
});

/* ===== البدء ===== */
btnStart.addEventListener('click', ()=>{
  const name = document.getElementById('studentName').value.trim();
  const sec = document.getElementById('section').value.trim();
  if(!name){ showToast('رجاءً اكتب اسم الطالب.'); return; }
  if(!sec){ showToast('اختر الشعبة (1–7).'); return; }
  elStart.classList.add('hidden');
  elQuiz.classList.remove('hidden');
  showToast('الاختبار بدأ الآن ✅');
  startTimer();
  renderQuestion();
});

/* ===== المؤقّت ===== */
function startTimer(){
  updateTimer();
  timerId = setInterval(()=>{
    remainingSec--; updateTimer();
    if(remainingSec<=0){ clearInterval(timerId); finishQuiz(); }
  },1000);
}
function updateTimer(){
  const m = Math.floor(remainingSec/60).toString().padStart(2,'0');
  const s = (remainingSec%60).toString().padStart(2,'0');
  elTimer.textContent = ${m}:${s};
}

/* ===== عرض سؤال واحد ===== */
function renderQuestion(){
  const q = QUESTIONS[current];
  elQNum.textContent = (current+1);
  elProg.textContent = سؤال ${current+1} من ${QUESTIONS.length};
  elBar.style.width = ${(current)/QUESTIONS.length*100}%;
  elTopic.textContent = q.topic || 'موضوع';

  // تنويع ترتيب الاختيارات وعلاماتها
  const labels = ["أ) ","ب) ","ج) ","د) "];
  const indexed = q.choices.map((c,i)=>({text:c, idx:i}));
  shuffle(indexed);
  elChoices.innerHTML = '';
  selectedIndex = (answers[current]?.chosen ?? null);

  indexed.forEach((obj,k)=>{
    const div = document.createElement('div');
    div.className='choice no-select';
    div.textContent = labels[k] + obj.text;
    div.tabIndex=0;
    div.addEventListener('click', ()=>{ clickTone(); selectChoice(obj.idx,div); });
    div.addEventListener('keydown',(e)=>{ if(['Enter',' '].includes(e.key)){ clickTone(); selectChoice(obj.idx,div);} });
    // إعادة إبراز الاختيار السابق (إن وجد)
    if(answers[current] && answers[current].chosen===obj.idx) div.classList.add('selected');
    elChoices.appendChild(div);
  });

  btnPrev.disabled = (current===0);
  btnConfirm.disabled = (answers[current]?.chosen==null && selectedIndex==null);
  btnNext.disabled = !confirmed[current];
}
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
function selectChoice(realIdx, el){
  [...elChoices.children].forEach(ch=> ch.classList.remove('selected'));
  el.classList.add('selected');
  selectedIndex = realIdx;
  btnConfirm.disabled = false;
}

/* ===== تأكيد — لا كشف صح/خطأ إطلاقًا ===== */
btnConfirm.addEventListener('click', ()=>{
  if(selectedIndex==null) return;
  const q = QUESTIONS[current];
  const isCorrect = (selectedIndex === q.answer);
  answers[current] = { chosen: selectedIndex, correctIndex: q.answer, isCorrect, topic:q.topic };
  confirmed[current] = true;
  btnNext.disabled = false;
  showToast('تم تسجيل إجابتك');
});

/* ===== التالي/السابق ===== */
btnNext.addEventListener('click', ()=>{
  // إذا السؤال القادم رقمُه من مضاعفات 5 — اعرض اللغز قبل تحميل السؤال الجديد
  const nextIndex = current + 1;
  if(nextIndex < QUESTIONS.length){
    const comingNumber = nextIndex + 1; // 1-based
    if(RIDDLE_INDEXES.has(comingNumber) && !solvedRiddles[comingNumber]){
      openRiddle(comingNumber);
      return; // أوقف هنا حتى يُحل اللغز
    }
    current++;
    renderQuestion();
  }else{
    finishQuiz();
  }
});
btnPrev.addEventListener('click', ()=>{
  if(current>0){
    current--;
    renderQuestion();
  }
});

/* ===== نافذة الألغاز ===== */
function openRiddle(qNumber1Based){
  const r = RIDDLES[qNumber1Based];
  rTitle.textContent = لغز سؤال رقم ${qNumber1Based}: ${r.prompt};
  r1.value = r.a[0]||''; r2.value = r.a[1]||''; r3.value = r.a[2]||'';
  rMsg.textContent = '';
  modal.classList.remove('hidden');

  rCheck.onclick = ()=>{
    const got = [r1.value.trim(), r2.value.trim(), r3.value.trim()];
    const ok = r.ok;
    if(got[0]===ok[0] && got[1]===ok[1] && got[2]===ok[2]){
      solvedRiddles[qNumber1Based] = true;
      rMsg.innerHTML = '<span class="ok">✔ أحسنت! تم حل اللغز.</span>';
      setTimeout(()=>{ modal.classList.add('hidden'); current++; renderQuestion(); }, 600);
    }else{
      rMsg.innerHTML = '<span class="bad">✘ غير صحيح — جرّب مرة أخرى.</span>';
    }
  };
  rClose.onclick = ()=>{ showToast('لا يمكن المتابعة بدون حل اللغز'); };
}

/* ===== النهاية + التقرير ===== */
function finishQuiz(){
  clearInterval(timerId);
  elQuiz.classList.add('hidden');
  elResult.classList.remove('hidden');

  const total = QUESTIONS.length;
  const got = answers.filter(a=>a && a.isCorrect).length;
  document.getElementById('scoreLine').textContent = درجتك: ${got} من ${total};

  const report = document.getElementById('report');
  report.innerHTML = '';
  QUESTIONS.forEach((q,idx)=>{
    const a = answers[idx] || {chosen:null, correctIndex:q.answer, isCorrect:false, topic:q.topic};
    const box = document.createElement('div');
    box.style.margin='10px 0'; box.style.padding='12px'; box.style.border='1px solid #e9eef5'; box.style.borderRadius='10px'; box.style.background='#fff';

    const num = idx+1;
    const head = document.createElement('div');
    head.innerHTML = <strong>س${num}.</strong> ${q.q} <span class="tag">${q.topic||''}</span>;
    const ua = (a.chosen!=null) ? q.choices[a.chosen] : '— لم يجب —';
    const ca = q.choices[q.answer];

    const p1 = document.createElement('p'); p1.style.margin='6px 0';
    p1.innerHTML = <span class="pill">إجابتك: ${ua}</span>;

    const p2 = document.createElement('p'); p2.style.margin='6px 0';
    p2.innerHTML = a.isCorrect ? ✔ صحيحة : ✘ خاطئة — <strong>هذه هي الإجابة الصحيحة:</strong> ${ca};

    box.appendChild(head);
    box.appendChild(p1);
    box.appendChild(p2);

    // إذا كانت خاطئة: أعرض سبب الخطأ + اسم الدرس + رابط يوتيوب مع دقيقة
    if(!a.isCorrect){
      const info = TOPIC_REVIEW[q.topic];
      if(info){
        const p3 = document.createElement('p'); p3.style.margin='6px 0';
        p3.innerHTML = سبب الخطأ: ${info.reason};
        const p4 = document.createElement('p'); p4.style.margin='6px 0';
        // إضافة دقيقة البدء كـ t=ثواني
        const urlWithT = info.url + &t=${info.t}s;
        p4.innerHTML = الدرس: <strong>${info.lesson}</strong> — <a href="${urlWithT}" target="_blank" rel="noopener">مشاهدة الشرح (من الدقيقة المناسبة)</a>;
        box.appendChild(p3); box.appendChild(p4);
      }
    }

    // إذا كان هذا السؤال من مجموعة اللغز ولم يُحل لغزه وقتها، نوّه بذلك
    const setNum = Math.ceil(num/5)*5; // أقرب نقطة لغز
    if(RIDDLE_INDEXES.has(setNum) && !solvedRiddles[setNum]){
      const warn = document.createElement('p'); warn.style.margin='6px 0'; warn.style.color='#7a4b00';
      warn.innerHTML = ملاحظة: لم تُحل لغز سؤال ${setNum} أثناء التقدم. (تم عرض الإجابات هنا لأن الاختبار انتهى);
      box.appendChild(warn);
    }

    report.appendChild(box);
  });
}
</script>
</body>
</html>
